<div class="department-detail" v-cloak>
  <div class="buttons">
    <a class="btn btn-dark" th:href="@{/admin/department}">Back to List</a>
    <button class="btn btn-danger" v-on:click="remove()" :disabled="hasMember">Delete
    </button>
  </div>
  <div class="department-info">
    <h3>Department</h3>
    <table class="table table-striped">
      <tbody>
      <tr>
        <th scope="row">Name</th>
        <td>{{ department.name }}</td>
      </tr>
      <tr>
        <th scope="row">Description</th>
        <td>{{ department.description }}</td>
      </tr>
      <tr>
        <th scope="row">Created At</th>
        <td>{{ department.createdDate }}</td>
      </tr>
      <tr>
        <th scope="row">Updated At</th>
        <td>{{ department.lastModifiedDate }}</td>
      </tr>
      </tbody>
    </table>
  </div>
  <div class="member-list">
    <h3>Members</h3>
    <table class="table table-striped" v-if="hasMember">
      <thead>
      <tr>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col">Email</th>
      </tr>
      </thead>
      <tbody>
      <tr v-for="(member, index) in department.members">
        <td>{{index+1}}</td>
        <td>{{ member.name }}</td>
        <td>{{ member.email }}</td>
      </tr>
      </tbody>
    </table>
    <p v-else>There is no member in this group</p>
  </div>
  <div class="duty_type-list">
    <h3>Duty Types</h3>
    <table class="table table-striped" v-if="hasDutyType">
      <thead>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Color</th>
      </tr>
      </thead>
      <tbody>
      <tr v-for="dutyType in department.dutyTypes">
        <td>{{ dutyType.name }}</td>
        <td>{{ dutyType.color }}</td>
      </tr>
      </tbody>
    </table>
    <p v-else>There is no duty type in this group</p>
  </div>
</div>

<script>
    $(function () {
        // current url last path is id
        const departmentId = window.location.pathname.split('/').pop();
        const app = new Vue({
            el: '.department-detail',
            data: {
                department: {}
            },
            mounted() {
                this.load();
            },
            computed: {
                hasMember: function () {
                    return this.department.members && this.department.members.length > 0;
                },
                hasDutyType: function () {
                    return this.department.dutyTypes && this.department.dutyTypes.length > 0;
                }
            },
            methods: {
                load: function () {
                    $.ajax({
                        url: '/admin/api/departments/' + departmentId,
                        type: 'GET',
                        success: function (response) {
                            app.department = response;
                        },
                        error: function (error) {
                            console.log(error);
                        }
                    })
                }, remove: function () {
                    Swal.fire({
                        title: 'Delete department',
                        text: 'Are you sure you want to delete this department?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Delete',
                        confirmButtonColor: '#d33',
                        cancelButtonText: 'Cancel'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            $.ajax({
                                url: '/admin/api/departments/' + app.department.id,
                                type: 'DELETE',
                                success: function (response) {
                                    window.location.href = '/admin/department';
                                },
                                error: function (error) {
                                    console.log(error);
                                }
                            })
                        }
                    });
                },
            }
        });
    })
</script>
