<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>TODO List</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
      body {
        background-color: #f3f4f6;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .container-custom {
        max-width: 40rem;
        padding: 1.25rem;
        background-color: #ffffff;
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        border-radius: 0.5rem;
      }

      #add-btn {
        background-color: #22c55e;
        color: #ffffff;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        border: 0;
        font-size: 1.125rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        white-space: nowrap;
      }

      #add-btn:hover {
        background-color: #16a34a;
      }

      #todo-list-container {
        display: flex;
        overflow-x: auto;
        padding-top: 0.75rem;
      }

      .draggable-item {
        cursor: grab;
        user-select: none;
        flex: 0 0 auto;
        display: flex;
        align-items: center;
        padding: 1rem;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-right: 1rem;
        min-width: 200px;
        transition: background-color 0.3s;
        position: relative;
      }

      .draggable-item:hover {
        background-color: #e2e8f0;
      }

      .draggable-item:active {
        cursor: grabbing;
      }

      .draggable-item.dragging {
        opacity: 0.5;
      }

      .todo-text {
        flex-grow: 1;
        cursor: pointer;
      }

      .delete-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 0.875rem;
        padding: 0.25rem 0.5rem;
      }

      .modal-content-custom {
        position: relative;
        padding: 1.25rem;
        border-radius: 0.5rem;
        background-color: #ffffff;
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
      }

      #add-modal .form-control {
        margin-bottom: 1rem;
      }

      .modal-dialog {
        margin-top: 30%;
      }

      #modal-date {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        font-size: 0.75rem;
      }
    </style>
  </head>

  <body>
    <div class="container-custom">
      <div class="d-flex align-items-center">
        <button id="add-btn">할일&nbsp;+</button>
        <div class="d-flex flex-row ms-3" id="todo-list-container">
          <div class="d-flex flex-row" id="todo-list"></div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="modal"
      tabindex="-1"
      aria-labelledby="modalTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content-custom">
          <button
            type="button"
            class="btn btn-danger btn-sm delete-btn"
            id="delete-todo"
          >
            삭제
          </button>
          <div class="modal-body">
            <h5 class="modal-title mb-3" id="modalTitle">TODO Title</h5>
            <p class="mb-3" id="modal-content">TODO Content</p>
            <p class="text-muted" id="modal-date"></p>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="add-modal"
      tabindex="-1"
      aria-labelledby="addModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content-custom">
          <div class="modal-header">
            <h5 class="modal-title" id="addModalLabel">Add New TODO</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <input
              type="text"
              id="todo-title-input"
              class="form-control"
              placeholder="Title"
            />
            <textarea
              id="todo-content-input"
              class="form-control"
              rows="4"
              placeholder="Content"
            ></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" id="add-todo" class="btn btn-success">
              Add
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const todoListElement = document.getElementById("todo-list");
      const addBtn = document.getElementById("add-btn");
      const modalElement = document.getElementById("modal");
      const addModalElement = document.getElementById("add-modal");
      const deleteTodoBtn = document.getElementById("delete-todo");
      const addTodoBtn = document.getElementById("add-todo");

      const modal = new bootstrap.Modal(modalElement);
      const addModal = new bootstrap.Modal(addModalElement);

      let todos = [
        {
          title: "룰렛돌리기",
          content: "매일 룰렛을 돌려 아이템을 받기 위해 룰렛을 돌릴 것",
          date: formatDate(new Date()),
        },
        {
          title: "안부전화",
          content: "아기가 잘 놀고 있는지 안부 전화 걸 것",
          date: formatDate(new Date()),
        },
        {
          title: "산책하기",
          content: "저녁에 30분 동안 산책하며 운동하기",
          date: formatDate(new Date()),
        },
        {
          title: "독서",
          content: "매일 30분씩 책 읽기",
          date: formatDate(new Date()),
        },
      ];
      let currentTodoIndex = null;

      const modalTitle = document.getElementById("modalTitle");
      const modalContent = document.getElementById("modal-content");
      const modalDate = document.getElementById("modal-date");

      function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        let hours = date.getHours();
        const minutes = String(date.getMinutes()).padStart(2, "0");
        const ampm = hours >= 12 ? "PM" : "AM";
        hours = hours % 12 || 12;
        return `${year}-${month}-${day} ${hours}:${minutes}${ampm}`;
      }

      function renderTodos() {
        todoListElement.innerHTML = "";
        todos.forEach((todo, index) => {
          const todoItem = document.createElement("div");
          todoItem.dataset.index = index;
          todoItem.className = "draggable-item";
          todoItem.style.width = "200px";

          const todoText = document.createElement("div");
          todoText.innerHTML = `<strong>${todo.title}</strong>`;
          todoText.className = "todo-text";
          todoText.addEventListener("click", () => {
            showTodoDetails(index);
          });

          todoItem.appendChild(todoText);
          todoListElement.appendChild(todoItem);
        });
      }

      function openAddTodoModal() {
        addModal.show();
      }

      function addTodo() {
        const title = document.getElementById("todo-title-input").value.trim();
        const content = document
          .getElementById("todo-content-input")
          .value.trim();
        const date = formatDate(new Date());

        if (title && content) {
          const newTodo = { title, content, date };
          todos.push(newTodo);
          renderTodos();
          addModal.hide();
          document.getElementById("todo-title-input").value = "";
          document.getElementById("todo-content-input").value = "";
        } else {
          alert("Both Title and Content are required!");
        }
      }

      function showTodoDetails(index) {
        const todo = todos[index];
        currentTodoIndex = index;
        modalTitle.textContent = todo.title;
        modalContent.textContent = todo.content;
        modalDate.textContent = todo.date;
        modal.show();
      }

      function deleteTodo() {
        if (currentTodoIndex !== null) {
          todos.splice(currentTodoIndex, 1);
          renderTodos();
          modal.hide();
        }
      }

      deleteTodoBtn.addEventListener("click", deleteTodo);
      addBtn.addEventListener("click", openAddTodoModal);
      addTodoBtn.addEventListener("click", addTodo);

      const sortable = new Sortable(todoListElement, {
        animation: 150,
        draggable: ".draggable-item",
        onEnd: function (evt) {
          const oldIndex = evt.oldIndex;
          const newIndex = evt.newIndex;
          const movedTodo = todos.splice(oldIndex, 1)[0];
          todos.splice(newIndex, 0, movedTodo);
          renderTodos();
        },
      });

      renderTodos();
    </script>
  </body>
</html>
